var M=Object.defineProperty;var C=(e,s)=>{for(var t in s)M(e,t,{get:s[t],enumerable:!0})};var P={parseTime:e=>{let s=Math.floor(e/3600),t=Math.floor(e%3600/60).toFixed(0).toString(),n=Math.floor(e%3600%60).toFixed(0).toString();n=n>=10?n:`0${n}`;let o=`${t}:${n}`;return s>0&&(t=t>=10?t:`0${t}`,o=`${s}:${t}:${n}`),o},getFileType:e=>e.substr((~-e.lastIndexOf(".")>>>0)+2),getFileName:e=>e.replace(/^.*[\\\/]/,"").split(".")[0],findParentIndex:e=>typeof e.dataset.picobelIndex<"u"?e.dataset.picobelIndex:typeof e.parentNode<"u"&&typeof e.parentNode.dataset<"u"?P.findParentIndex(e.parentNode):!1},m=P;var E=(e="default")=>{switch(e){case"itunes":return["playPause",[["title","artist"],["timer","progress","duration"]]];case"default":default:return["playPause",["mute","volume"],["title","artist"],["timer","progress","duration"]]}},T=(e={})=>{let s={context:document,theme:"default",preload:!1},{components:t,...n}=e,o=E(e.theme),i={...s,components:o,...n};return t&&Array.isArray(t)&&(i.components=t),i};var A={findAudio:e=>{let s=e.getElementsByTagName("audio");return[].slice.call(s)},prepareClasses:(e,s,t)=>[...`picobel loading picobel--index-${e} ${s}`.trim().split(" "),t],getRawData:e=>e.map((s,t)=>(s.key=t,s.mute=!1,s.tmpVolume=1,s)),getMeta:e=>{let s={};return s.url=e.currentSrc,s.fileType=m.getFileType(s.url),s.fileName=m.getFileName(s.url),s.title=e.title&&e.title!==""?e.title:`${s.fileName}.${s.fileType}`,e.dataset?s.artist=e.dataset.artist?e.dataset.artist:!1:s.artist=!1,s}},y=A;var v={};C(v,{artist:()=>w,duration:()=>H,mute:()=>q,playPause:()=>S,progress:()=>D,timer:()=>B,title:()=>k,volume:()=>F});var p=(e="div",s="")=>{let t=document.createElement(e);return t.className=s,t},x=({key:e,container:s,components:t,namespace:n})=>(t.forEach(o=>{if(typeof o=="string"&&v[o]){let i=v[o](n,e);s.appendChild(i);return}if(Array.isArray(o)&&o.length){let i=o.flat().join("-"),c=p("div",`${n}__wrapper--${i}`),r=x({key:e,container:c,components:o,namespace:n});s.appendChild(r)}}),s);var b=({namespace:e="picobel",min:s=0,max:t=100,value:n=0,step:o=!1,index:i=0,label:c="slider"})=>{let r=p("div",e),l=p("div",`${e}-slider__wrapper`),a=p("div",`${e}-slider__replacement`),u=p("div",`${e}-slider__background`);a.appendChild(u);let d=p("div",`${e}-slider__indicator`);a.appendChild(d);let h=p("div",`${e}-slider__playhead`);a.appendChild(h),l.appendChild(a);let $=`${e}-slider__range--${i}`,f=p("input",`${e}-slider__range`);f.setAttribute("id",$),f.setAttribute("type","range"),f.setAttribute("min",s),f.setAttribute("max",t),f.setAttribute("value",n),o&&f.setAttribute("step",o),l.appendChild(f);let g=p("label",`${e}-label`);return typeof c=="string"?g.innerHTML=c:g.appendChild(c),g.setAttribute("for",$),r.appendChild(g),r.appendChild(l),r};var S=e=>{let s=p("button",`${e}__play-pause`);s.setAttribute("type","button");let t=p("span",`${e}__play-pause__text`);return t.innerHTML="Play",s.appendChild(t),s},k=(e,s)=>{let t=p("span",`${e}__title`);return t.innerHTML="File "+(s+1),t},w=e=>p("span",`${e}__artist`),B=e=>{let s=p("span",`${e}__timer`);return s.innerHTML="0:00",s},H=e=>{let s=p("span",`${e}__duration`);return s.innerHTML="-:--",s},D=(e,s)=>{let t=p("span",`${e}__progress-label-inner`);return t.innerHTML="Progress",b({namespace:`${e}__progress`,min:0,max:100,value:0,index:s,label:t})},q=e=>{let s=p("button",`${e}__mute`);return s.setAttribute("type","button"),s.innerHTML="Mute",s},F=(e,s)=>{let t=p("span",`${e}__volume-label-inner`),n=p("span",`${e}__volume-label-key`);n.innerHTML="Volume ",t.appendChild(n);let o=p("span",`${e}__volume-label-value`);return o.innerHTML="10",t.appendChild(o),b({namespace:`${e}__volume`,min:0,max:1,value:1,step:.1,index:s,label:t})};var I={setLengthDisplay:e=>{let s=m.parseTime(e.duration);return e.elements.durationDisplay&&(e.elements.durationDisplay.innerHTML=s),e},setMeta:(e,s)=>(e.artist&&s.artistDisplay&&(s.artistDisplay.innerHTML=e.artist),s.titleDisplay&&(s.titleDisplay.innerHTML=e.title),s),generateMarkup:(e=[],s,t)=>e.map(o=>{let i=p("div"),c=y.prepareClasses(o.key,o.className,t);i.classList.add(...c),i.setAttribute("data-picobel-index",o.key);let r=p("div",`${t}__loader`);return i.appendChild(r),x({key:o.key,container:i,components:s,namespace:t})}),elementHooks:(e,s,t)=>e.map(n=>{let o=s.querySelector(`[data-picobel-index='${n.key}']`);return n.elements={wrapper:o,playPauseButton:o.querySelector(`.${t}__play-pause`),playPauseButtonText:o.querySelector(`.${t}__play-pause__text`),muteButton:o.querySelector(`.${t}__mute`),playTimer:o.querySelector(`.${t}__timer`),durationDisplay:o.querySelector(`.${t}__duration`),titleDisplay:o.querySelector(`.${t}__title`),artistDisplay:o.querySelector(`.${t}__artist`),progressWrapper:o.querySelector(`.${t}__progress-slider__replacement`),progressBar:o.querySelector(`.${t}__progress-slider__range`),playhead:o.querySelector(`.${t}__progress-slider__playhead`),indicator:o.querySelector(`.${t}__progress-slider__indicator`),volumeWrapper:o.querySelector(`.${t}__volume-slider__replacement`),volumeControl:o.querySelector(`.${t}__volume-slider__range`),volumeDisplay:o.querySelector(`.${t}__volume-label-value`),volumeIndicator:o.querySelector(`.${t}__volume-slider__indicator`),volumePlayhead:o.querySelector(`.${t}__volume-slider__playhead`)},n})},_=I;var N=(e={})=>{let s=T(e),t={audioNodes:[],theme:s.theme,components:s.components},n=(r,l)=>{r.map((a,u)=>{a.parentNode.replaceChild(l[u],a)})},o=r=>r.map((l,a)=>(l.addEventListener("timeupdate",i.triggerUpdateProgress,!1),l.addEventListener("canplaythrough",i.canplaythrough,!1),l.addEventListener("error",()=>i.errors(a),!1),l.elements.playPauseButton&&l.elements.playPauseButton.addEventListener("click",i.triggerPlayPauseAudio,!1),l.elements.progressBar&&l.elements.progressBar.addEventListener("input",i.sliderScrub,!1),l.elements.progressBar&&l.elements.progressBar.addEventListener("focus",u=>i.sliderFocus(u,!0),!1),l.elements.progressBar&&l.elements.progressBar.addEventListener("blur",u=>i.sliderFocus(u,!1),!1),l.elements.volumeControl&&l.elements.volumeControl.addEventListener("input",i.volume,!1),l.elements.volumeControl&&l.elements.volumeControl.addEventListener("focus",u=>i.volumeFocus(u,!0),!1),l.elements.volumeControl&&l.elements.volumeControl.addEventListener("blur",u=>i.volumeFocus(u,!1),!1),l.elements.muteButton&&l.elements.muteButton.addEventListener("click",i.muteUnmuteAudio,!1),l)),i={pauseAll:()=>{t.audioNodes.forEach(r=>{i.pause(r)})},triggerPlayPauseAudio:r=>{let l=m.findParentIndex(r.srcElement),a=t.audioNodes.find(u=>u.key==l);i.playPauseAudio(a)},playPauseAudio:r=>{r.paused||r.currentTime===0?(i.pauseAll(),i.play(r)):i.pause(r)},play:r=>{r.play();let l=r.elements.playPauseButton,a=r.elements.playPauseButtonText;l.classList.remove("paused"),a.innerHTML="Pause",l.classList.add("playing")},pause:r=>{r.pause();let l=r.elements.playPauseButton,a=r.elements.playPauseButtonText;l.classList.remove("playing"),a.innerHTML="Play",l.classList.add("paused")},stop:r=>{r.pause();let l=r.elements.playPauseButton,a=r.elements.playPauseButtonText;l.classList.remove("playing"),a.innerHTML="Play"},triggerUpdateProgress:r=>i.updateProgress(r.srcElement),updateProgress:r=>{let l=r.currentTime,a=r.duration;if(r.elements.playTimer){let d=m.parseTime(l);r.elements.playTimer.innerHTML=d}l>=a&&i.stop(r);let u=(l/a*100).toFixed(2);r.elements.progressBar&&(r.elements.progressBar.value=u,r.elements.indicator.style.width=u+"%",r.elements.playhead.style.left=u+"%")},canplaythrough:function(){_.setLengthDisplay(this),this.elements.wrapper.classList.remove("loading");let r=y.getMeta(this);_.setMeta(r,this.elements)},errors:r=>{let{elements:l}=t.audioNodes[r];l.wrapper.classList.add("error"),l.wrapper.classList.remove("loading"),l.wrapper.innerHTML='<div class="error" style="display:flex;height: 100%;align-items:  center;justify-content: center;"><span class="error__icon"></span><span class="error__message">Error loading audio file</span></div>'},sliderScrub:r=>{let l=m.findParentIndex(r.srcElement),a=t.audioNodes.find(h=>h.key==l),d=a.duration*(r.srcElement.value/100);d=d.toFixed(2),a.currentTime=d,i.updateProgress(a)},sliderFocus:(r,l)=>{let a=m.findParentIndex(r.srcElement);t.audioNodes.find(d=>d.key==a).elements.progressWrapper.classList.toggle("focus",l)},volume:r=>{let l=m.findParentIndex(r.srcElement),a=t.audioNodes.find(d=>d.key==l),u=r.srcElement.value;a.tmpVolume=a.volume,a.mute=!1,i.mute(a),i.setVolume(a,u)},volumeFocus:(r,l)=>{let a=m.findParentIndex(r.srcElement);t.audioNodes.find(d=>d.key==a).elements.volumeWrapper.classList.toggle("focus",l)},setVolume:(r,l)=>{let a=l*10,u=l*100;r.volume=l,r.elements.volumeDisplay&&(r.elements.volumeDisplay.innerHTML=a),r.elements.volumeControl&&(r.elements.volumeControl.value=l),r.elements.volumeIndicator&&(r.elements.volumeIndicator.style.width=u+"%"),r.elements.volumePlayhead&&(r.elements.volumePlayhead.style.left=u+"%")},muteUnmuteAudio:r=>{let l=m.findParentIndex(r.srcElement),a=t.audioNodes.find(u=>u.key==l);a.mute=!a.mute,i.mute(a)},mute:r=>{let l=r.elements.muteButton;r.mute?(r.tmpVolume=r.volume,i.setVolume(r,0),l.classList.add("muted"),l.classList.remove("unmuted"),l.innerHTML="Unmute"):(typeof r.tmpVolume<"u"&&r.tmpVolume>0?i.setVolume(r,r.tmpVolume):i.setVolume(r,1),l.classList.remove("muted"),l.classList.add("unmuted"),l.innerHTML="Mute")}};t.audioNodes=y.findAudio(s.context),t.audioNodes=y.getRawData(t.audioNodes);let c=_.generateMarkup(t.audioNodes,t.components,t.theme);return n(t.audioNodes,c),t.audioNodes=_.elementHooks(t.audioNodes,s.context,t.theme),t.audioNodes=o(t.audioNodes),t.audioNodes.forEach(r=>{let{readyState:l}=r;l===4&&i.canplaythrough.call(r)}),{state:t,PicobelAudio:i}};var L=class extends HTMLElement{constructor(){super()}connectedCallback(){let s=this.classList[0]||"default",t=this.getAttribute("data-theme")||s;console.log({theme:t});let n={theme:t,context:this},o=this.getAttribute("data-components");o&&(n.components=JSON.parse(o)),N(n)}};typeof window<"u"&&"customElements"in window&&window.customElements.define("picobel-player",L);
